{% extends 'base.html' %} {% block title %} Contribute {% endblock %} {% block
content %}
<style>
  button:disabled {
    background-color: #dddddd;
    color: #999999;
    cursor: not-allowed;
  }
</style>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<body class = "bg-slate-100">
  <div id = "loading-bar" class="hidden fixed top-0 left-0 w-full h-full z-50 flex items-center justify-center">
    <div class="absolute inset-0 bg-black opacity-50"></div>
    <button type="button" class="relative bg-orange-500 h-max w-max rounded-lg text-white font-bold hover:bg-indigo-300 hover:cursor-not-allowed duration-[500ms,800ms]" disabled>
      <div class="flex items-center justify-center m-[10px]"> 
          <div class="h-5 w-5 border-t-transparent border-solid animate-spin rounded-full border-white border-4"></div>
          <div class="ml-2"> Processing...This may take a few minutes <div>
      </div>
  </button>
  </div>
  <div class="flex items-center justify-center ">
    <div class = "mt-12 ">
  <p class = "text-4xl text-orange-600 content-start font-bold px-5 mt-12">Contribute</p>
  <p class = "text-1xl text-orange-600 font-medium px-5 mt-3">
    Thank you for your interest in contributing to the improvement of our Auto Priority Classification System for damaged road segments.<br />
    Your input plays a vital role in enhancing road safety and maintenance in Mandaluyong City.
  </p>
  <div class="container bg-white shadow-md rounded mt-5 p-3 lg:p-5 mb-8">
    <div class="flex flex-col lg:flex-row justify-center">
      <!-- Left Div: Upload Dashcam Footage -->
      <div class="hidden sm:block w-full lg:w-1/2 px-5">
        <p class="text-3xl text-gray-700 font-medium">Upload Dashcam Footage</p>
        <p class = "text-1xl text-gray-700 font-light mt-2">
          <a href="{{ url_for('rfex_instruction') }}" class="text-orange-600 hover:underline" >Click here</a> for detailed instructions on how to upload your dashcam footage
        </p>
        <div class="max-w-md mt-5 mx-auto">
          <div class="mb-4">
              <label for="gpx_file" class="block text-gray-700 font-semibold mb-2">Upload GPX File:</label>
              <input type="file" name="gpx_file" id="gpx_file" accept=".gpx" required
                     class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-indigo-500"/>
          </div>
          <div class="mb-6">
              <label for="mp4_file" class="block text-gray-700 font-semibold mb-2">Upload MP4 File:</label>
              <input type="file" name="mp4_file" id="mp4_file" accept=".mp4" required
                     class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-indigo-500"/>
          </div>
          <div class="flex justify-center">
              <button id="uploadButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Upload</button>
          </div>
      </div>
      </div>
    
      <!-- Line Divider -->
      <div class="hidden lg:block w-px bg-gray-300 mx-5 my-6"></div>
    
      <!-- Right Div: Upload Simple Pictures -->
      <div class="w-full lg:w-1/2 px-5 mt-12 lg:mt-0">
        <p class="text-3xl text-gray-700 font-medium">Upload Simple Pictures</p>
        <p class = "text-1xl text-gray-700 font-light mt-2">
          Instructions:<br>
          1. Click Choose File below the instructions.<br>
          2. Select a corresponding JPG/JPEG image of the road damage to upload.<br>
          3. (If your image is not geotagged) When a map pops up, please select the approximate area of where the reported road damage is taken.
        </p>
        <form
        action="/upload_non_rfex_contribution"
        method="POST"
        enctype="multipart/form-data"
        class="max-w-md mx-auto"
        id="upload_non_rfex"
      >
              <input type="hidden" name="coords" id="coords" value="" />
              <input type="hidden" name="timeStamp" id="timeStamp" value="" />
              <input type="hidden" name="action" id="action" value="">
              <div class="mb-4">
          <label for="non_rfex_image" class="block text-gray-700 font-semibold mb-2 mt-2"
            >Upload Image:</label
          >
          <input
            type="file"
            name="non_rfex_image"
            id="non_rfex_image"
            accept=".jpg, .jpeg"
            required
            class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-indigo-500"
          />
              </div>
              <!-- Modal For With Coordinates -->
              <div id="uploadModal" class="fixed top-0 left-0 w-full h-full flex items-center justify-center hidden bg-gray-500 bg-opacity-75" style="z-index: 1000;">
                <div class="absolute bg-white p-8 rounded shadow-lg">
                  <p id="coordinatesText" class="text-lg font-semibold mb-4"></p>
                  <img id="uploadedImage" class="mb-4" style="max-height: 400px" alt="Uploaded Image" />
                  <div class="mb-4">
                    <label for="is_sidewalk" class="flex items-center">
                      <input type="checkbox" name="is_sidewalk" id="is_sidewalk" class="mr-2" />
                      <span class="text-gray-700 font-semibold">Is there a sidewalk?</span>
                    </label><br>
                    <label for="is_oneway" class="flex items-center">
                      <input type="checkbox" name="is_oneway" id="is_oneway" class="mr-2" />
                      <span class="text-gray-700 font-semibold">Is this a one-way road?</span>
                    </label><br>
                    <p id="timeStampText" class="text-lg font-semibold mb-4 hidden"></p>
                    <label id="dateTimePickerLabel" for="dateTimePicker">Enter time and date the picture was taken</label><br>
                    <input type="datetime-local" id="dateTimePicker" name="dateTimePicker" class="hidden w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-orange-600 sm:text-sm sm:leading-6">
                    <script>
                      document.addEventListener('DOMContentLoaded', function () {
                        const dateTimePicker = document.getElementById('dateTimePicker');
                        const now = new Date();
                        const year = now.getFullYear();
                        const month = ('0' + (now.getMonth() + 1)).slice(-2);
                        const day = ('0' + now.getDate()).slice(-2);
                        const hours = ('0' + now.getHours()).slice(-2);
                        const minutes = ('0' + now.getMinutes()).slice(-2);
                        const maxDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;
                        dateTimePicker.max = maxDateTime;
                      });
                    </script>
                  </div>
                  <!-- Modal For Map -->
                  <div id="coordinatesModal" class="modal hidden fixed inset-0 bg-gray-500 bg-opacity-75 z-50 overflow-auto flex items-center justify-center">
                    <div class="modal-container h-screen w-screen flex items-center justify-center">
                        <div class="modal-content bg-white shadow-md rounded p-4">
                            <span class="modal-close cursor-pointer absolute top-0 right-0 p-4" onclick="closeMapModal()">&times;</span>
                            <div id="map" class="mb-2" style="height: 80vh; width: 80vh;"></div>
                            <p class="text-center text-gray-600 font-medium mb-2">
                                Geolocation was not turned on for this image. Kindly select the exact area on the map where this image was taken.
                            </p>
                            <p id="coordinatesTextMap" class="text-center text-gray-600"></p>
                            <p id="streetTextMap" class="text-center text-gray-600 mb-2"></p>
                            <p id="locationText" class="text-center text-red-600 font-medium mb-2"></p>
                
                            <!-- Add a confirmation button -->
                            <div class="flex justify-center">
                                <button id="confirmMapBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mx-2" disabled>
                                    Confirm
                                </button>
                                <button id="closeMapModalBtn" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mx-2">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
    
            <div class="flex justify-center">
              <button
              id = "uploadImageButton"
                type="submit"
                name="action"
                value="upload"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mx-2"
                onclick="openSuccessModal()"
             disabled>
                Upload
              </button>
              <button
                type="submit"
                name="action"
                value="cancel"
                id="closeModalBtn"
                class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mx-2"
              >
                Cancel
              </button>
                </div>
              </div> 
              </div>
            </form>
            <p class = "text-1xl text-gray-700 font-light mt-2">
              Alternatively (For Users Taking A Picture Using The Website):<br>
              1. You can access this through your mobile phone and take the picture of the pothole directly<br>
              2. Save the image in JPG format for optimal compatibility.<br>
              3. Click on the "Upload" button below to process your file.
            </p>
      </div>
    </div>
    <center>
    <div class="mt-8">
      <p class="text-3xl text-gray-700 font-medium">Tutorial Video</p>
      <div class="mt-4">
        <!-- Replace 'path_to_your_video.mp4' with the actual path to your video file -->
        <a href="{{ url_for('static', filename='tutorial.mp4') }}" target="_blank">
          <video controls width="50%">
            <source src="{{ url_for('static', filename='tutorial.mp4') }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </a>
      </div>
    </div>
  </center>
  </div>
</div>

</div>
<div id="successModal" class="modal hidden fixed inset-0 flex items-center justify-center z-50 bg-gray-500 bg-opacity-75" style="z-index: 1000;">
  <div class="modal-container bg-white w-11/12 md:max-w-md rounded shadow-lg overflow-y-auto">
    <div class="py-4 px-10">
      <div class="flex justify-center mb-10 mt-2"><img src="{{url_for('static', filename='images/check.png')}}" style="height: 50px; width: 50px;" /></div>
      <p class="text-md font-medium text-center mt-2">
        Thank you for your contribution to our website. Our quality control team will now review and ensure that everything meets our standards.
      </p>
      <div class="flex justify-center">
        <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-7 rounded mt-5 mb-3" onclick="closeSuccessModal()">Close</button>
      </div>
    </div>
  </div>
</div>

<div id="notInMandaluyongModal" class="modal hidden fixed inset-0 flex items-center justify-center z-50 bg-gray-500 bg-opacity-75" style="z-index: 1000;">
  <div class="modal-container bg-white w-11/12 md:max-w-md rounded shadow-lg overflow-y-auto">
    <div class="py-4 px-10">
      <div class="flex justify-center mb-10 mt-2"><img src="{{url_for('static', filename='images/close.png')}}" style="height: 50px; width: 50px;" /></div>
      <p class="text-md font-medium text-center mt-2">
        Image uploaded was not in Mandaluyong.
      </p>
      <div class="flex justify-center">
        <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-7 rounded mt-5 mb-3" onclick="closeMandaluyongModal()">Close</button>
      </div>
    </div>
  </div>
</div>

<div id="invalidImageModal" class="modal hidden fixed inset-0 flex items-center justify-center z-50 bg-gray-500 bg-opacity-75" style="z-index: 1000;">
  <div class="modal-container bg-white w-11/12 md:max-w-md rounded shadow-lg overflow-y-auto">
    <div class="py-4 px-10">
      <div class="flex justify-center mb-10 mt-2"><img src="{{url_for('static', filename='images/close.png')}}" style="height: 50px; width: 50px;" /></div>
      <p class="text-md font-medium text-center mt-2">
        Image uploaded is invalid or a duplicate.
      </p>
      <div class="flex justify-center">
        <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-7 rounded mt-5 mb-3" onclick="closeInvalidImageModal()">Close</button>
      </div>
    </div>`
  </div>
</div>

</body>

<script type="text/javascript" src="{{ url_for('static', filename='contribution.js') }}"></script>

{% endblock %}
